# Profile data generated by Devel::NYTProf::Reader
# Version: v5.06
# More information at http://search.cpan.org/dist/Devel-NYTProf/
# Format: time,calls,time/call,code
0.000000,0,0.000000,package Module::Implementation;
0.000000,0,0.000000,{
0.000005,2,0.000003,$Module::Implementation::VERSION = '0.07';
0.000000,0,0.000000,}
0.000000,0,0.000000,BEGIN {
0.000008,1,0.000008,$Module::Implementation::AUTHORITY = 'cpan:DROLSKY';
0.000021,1,0.000021,}
0.000000,0,0.000000,
0.000084,2,0.000042,use strict;
0.000036,2,0.000018,use warnings;
0.000000,0,0.000000,
0.000184,3,0.000061,use Module::Runtime 0.012 qw( require_module );
0.000641,2,0.000321,use Try::Tiny;
0.000000,0,0.000000,
0.000001,1,0.000001,my %Implementation;
0.000000,0,0.000000,
0.000000,0,0.000000,sub build_loader_sub {
0.000009,4,0.000002,my $caller = caller();
0.000000,0,0.000000,
0.000041,4,0.000010,return _build_loader( $caller, @_ );
0.000000,0,0.000000,}
0.000000,0,0.000000,
0.000000,0,0.000000,sub _build_loader {
0.000007,4,0.000002,my $package = shift;
0.000012,4,0.000003,my %args    = @_;
0.000000,0,0.000000,
0.000011,4,0.000003,my @implementations = @{ $args{implementations} };
0.000009,4,0.000002,my @symbols = @{ $args{symbols} || [] };
0.000000,0,0.000000,
0.000006,4,0.000001,my $implementation;
0.000010,4,0.000002,my $env_var = uc $package;
0.000047,4,0.000012,$env_var =~ s/::/_/g;
0.000007,4,0.000002,$env_var .= '_IMPLEMENTATION';
0.000000,0,0.000000,
0.000000,0,0.000000,return sub {
0.000035,4,0.000009,my ( $implementation, $loaded ) = _load_implementation(
0.000000,0,0.000000,$package,
0.000000,0,0.000000,$ENV{$env_var},
0.000000,0,0.000000,\@implementations,
0.000000,0,0.000000,);
0.000000,0,0.000000,
0.000009,4,0.000002,$Implementation{$package} = $implementation;
0.000000,0,0.000000,
0.000024,4,0.000006,_copy_symbols( $loaded, $package, \@symbols );
0.000000,0,0.000000,
0.000029,4,0.000007,return $loaded;
0.000038,4,0.000009,};
0.000000,0,0.000000,}
0.000000,0,0.000000,
0.000000,0,0.000000,sub implementation_for {
0.000006,3,0.000002,my $package = shift;
0.000000,0,0.000000,
0.000024,3,0.000008,return $Implementation{$package};
0.000000,0,0.000000,}
0.000000,0,0.000000,
0.000000,0,0.000000,sub _load_implementation {
0.000007,4,0.000002,my $package         = shift;
0.000009,4,0.000002,my $env_value       = shift;
0.000006,4,0.000001,my $implementations = shift;
0.000000,0,0.000000,
0.000007,4,0.000002,if ($env_value) {
0.000000,0,0.000000,die "$env_value is not a valid implementation for $package"
0.000000,0,0.000000,unless grep { $_ eq $env_value } @{$implementations};
0.000000,0,0.000000,
0.000000,0,0.000000,my $requested = "${package}::$env_value";
0.000000,0,0.000000,
0.000000,0,0.000000,# Values from the %ENV hash are tainted. We know it's safe to untaint
0.000000,0,0.000000,# this value because the value was one of our known implementations.
0.000000,0,0.000000,($requested) = $requested =~ /^(.+)$/;
0.000000,0,0.000000,
0.000000,0,0.000000,try {
0.000000,0,0.000000,require_module($requested);
0.000000,0,0.000000,}
0.000000,0,0.000000,catch {
0.000000,0,0.000000,require Carp;
0.000000,0,0.000000,Carp::croak("Could not load $requested: $_");
0.000000,0,0.000000,};
0.000000,0,0.000000,
0.000000,0,0.000000,return ( $env_value, $requested );
0.000000,0,0.000000,}
0.000000,0,0.000000,else {
0.000006,4,0.000001,my $err;
0.000009,4,0.000002,for my $possible ( @{$implementations} ) {
0.000009,4,0.000002,my $try = "${package}::$possible";
0.000000,0,0.000000,
0.000006,4,0.000001,my $ok;
0.000000,0,0.000000,try {
0.000025,4,0.000006,require_module($try);
0.000021,4,0.000005,$ok = 1;
0.000000,0,0.000000,}
0.000000,0,0.000000,catch {
0.000000,0,0.000000,$err .= $_ if defined $_;
0.000067,4,0.000017,};
0.000000,0,0.000000,
0.000031,4,0.000008,return ( $possible, $try ) if $ok;
0.000000,0,0.000000,}
0.000000,0,0.000000,
0.000000,0,0.000000,require Carp;
0.000000,0,0.000000,if ( defined $err && length $err ) {
0.000000,0,0.000000,Carp::croak(
0.000000,0,0.000000,"Could not find a suitable $package implementation: $err");
0.000000,0,0.000000,}
0.000000,0,0.000000,else {
0.000000,0,0.000000,Carp::croak(
0.000000,0,0.000000,'Module::Runtime failed to load a module but did not throw a real error. This should never happen. Something is very broken'
0.000000,0,0.000000,);
0.000000,0,0.000000,}
0.000000,0,0.000000,}
0.000000,0,0.000000,}
0.000000,0,0.000000,
0.000000,0,0.000000,sub _copy_symbols {
0.000007,4,0.000002,my $from_package = shift;
0.000006,4,0.000002,my $to_package   = shift;
0.000006,4,0.000002,my $symbols      = shift;
0.000000,0,0.000000,
0.000034,4,0.000008,for my $sym ( @{$symbols} ) {
0.000056,7,0.000008,my $type = $sym =~ s/^([\$\@\%\&\*])// ? $1 : '&';
0.000000,0,0.000000,
0.000014,7,0.000002,my $from = "${from_package}::$sym";
0.000012,7,0.000002,my $to   = "${to_package}::$sym";
0.000000,0,0.000000,
0.000000,0,0.000000,{
0.000070,9,0.000008,no strict 'refs';
0.000102,2,0.000051,no warnings 'once';
0.000000,0,0.000000,
0.000000,0,0.000000,# Copied from Exporter
0.000000,0,0.000000,*{$to}
0.000000,0,0.000000,= $type eq '&' ? \&{$from}
0.000000,0,0.000000,: $type eq '$' ? \${$from}
0.000000,0,0.000000,: $type eq '@' ? \@{$from}
0.000000,0,0.000000,: $type eq '%' ? \%{$from}
0.000032,7,0.000005,: $type eq '*' ? *{$from}
0.000000,0,0.000000,: die
0.000000,0,0.000000,"Can't copy symbol from $from_package to $to_package: $type$sym";
0.000000,0,0.000000,}
0.000000,0,0.000000,}
0.000000,0,0.000000,}
0.000000,0,0.000000,
0.000004,1,0.000004,1;
0.000000,0,0.000000,
0.000000,0,0.000000,# ABSTRACT: Loads one of several alternate underlying implementations for a module
0.000000,0,0.000000,
0.000000,0,0.000000,__END__
